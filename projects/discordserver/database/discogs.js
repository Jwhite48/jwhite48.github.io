var Discogs=require("disconnect").Client;const fs=require("fs"),MongoClient=require("mongodb").MongoClient,discogs_key="{{DISCOGS API KEY GOES HERE}}",database_user_name="{{MONGO USERNAME GOES HERE}}",database_user_password="{{MONGO PASSWORD GOES HERE}}",database_name="Albums",uri="mongodb+srv://"+database_user_name+":"+database_user_password+"@cluster.cjylvb8.mongodb.net/"+database_name+"?retryWrites=true&w=majority",client=new MongoClient(uri,{useUnifiedTopology:!0});var db=new Discogs({userToken:discogs_key}).database();const cName="{{COLLECTION NAME}}",fileN="./album_lists/{{FILE NAME}}";var releases=[],text=fs.readFileSync(fileN,"utf-8"),textByLine=text.split("\n");for(let e=0;e<textByLine.length;e++)0===e?releases[0]=parseInt(textByLine[e].trim()):(releases.push({}),releases[releases.length-1].artist=textByLine[e].substring(0,textByLine[e].indexOf("-")).trim(),releases[releases.length-1].name=textByLine[e].substring(textByLine[e].indexOf("-")+1).trim());var savesPending=releases.length-1;client.connect(function(e,s){for(let e=1;e<releases.length;e++)db.search(`${releases[e].artist} - ${releases[e].name}`,{type:"release",page:1,pages:1,per_page:5},async function(t,r){console.log(`${releases[e].artist} - ${releases[e].name}`);var a={country:"",year:"",label:"",genres:[],styles:[],_id:"",order:e+releases[0]-1,url:"discogs.com",img_url:"",type:"release",name:releases[e].name,artist:releases[e].artist};a.country=r.results[0].country,a.year=r.results[0].year,a.label=r.results[0].label[0],a.genres=r.results[0].genre,a.styles=r.results[0].style,a._id=r.results[0].id,a.url+=r.results[0].uri,a.img_url=r.results[0].cover_image,await s.db().collection(cName).insertOne(a),savesPending--,console.log(savesPending),0===savesPending&&(console.log("DONE!"),await s.close())})});